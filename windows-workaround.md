# Sorry I failed

I've looked it over and tried my best to stay in windows but it just doesn't work for me.
My set up when I tried 08/02/2021

-   Windows 10 (64x)
-   Python 3.9.1
-   Android Studio
-   Xampp
-   Anaconda
-   Visual Studio 2019
-   Visual Studio Build Tools 2019
-   [mysqlclient-1.4.6-cp39-cp39-win_amd64.whl] (https://www.lfd.uci.edu/~gohlke/pythonlibs/#mysqlclient)
-   Using virtulenv for my virtual environment

## Probably the problems

Python packages sometimes have components that need to be compiled with eg: C, C++, Fortran, for performance. As in tensorflow, numpy and in this case for mysql.
To compile the correct compiler, headers, libreries, etc... are needed
(my error message has to do specific with missing headers, which never seem to be found)

## Some solutions

-   Add the headers headers, libreries, etc.. where the installer can find them
-   Install a version that doesn't need to be compiled whl
-   Use an OS that allocates all resources where the installer can find them

# Workaround

## using WSL2 with ubuntu

[Install WSL & update to WSL 2](https://docs.microsoft.com/en-us/windows/wsl/install-win10#manual-installation-steps)

1. Enable the Windows Subsystem for Linux: `dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart`
2. Virtual machine `dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart`
3. Install linux kernel [WSL2 Linux kernel update package for x64 machines](https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_x64.msi)
4. Set default version `wsl --set-default-version 2`
5. Install your Linux distribution of choice from the windows store.

## Workaround using virtualbox and an Ubuntu Machine

1. download and install virtualbox
2. download an iso for ubuntu and create a machine in virtualbox

## Setting up the Core

1. Install git

```
sudo apt-get update
sudo apt-get install git
```

2. Set general info

```
git config --global user.name "username"
git config --global user.email "words@email.com"
```

3. Clone the core `git clone https://github.com/afinidata2019/afinidata_core`
4. run the commands found in [init_ubuntu_build_env.sh](https://github.com/afinidata2019/afinidata_service/blob/leo_dev/dev/scripts/linux/init_ubuntu_build_env.sh)
5. run `apt install -y libmariadbclient-dev`
6. run `apt install -y libmysqlclient-dev`
7. run `pip3 install -r requirements.txt `
8. cd to /etc/
9. modify the hosts file: `sudo nano hosts` changing it so they refer to the same adapter:

    - WLS2

        - host file

        ```
        # This file was automatically generated by WSL. To stop automatic generation of this file, add the following entry to /etc/wsl.conf:
        # [network]
        # generateHosts = false
        127.0.0.1       ip4-localhost
        ::1 localhost
        ```

        - User folder: cd to home/user/

        ```
        echo "[wsl2]" >> .wslconfig
        echo "localhostForwarding=true" >> .wslconfig
        ```

    - Virtualbox
      _Note: You need 2 adapters one with NAT and the second one with "host only"_

        - host file

        ```
        10.0.2.2        localhost
        10.0.2.2        domain

        # The following lines are desirable for IPv6 capable hosts
        ::1     ip6-localhost ip6-loopback
        fe00::0 ip6-localnet
        ff00::0 ip6-mcastprefix
        ff02::1 ip6-allnodes
        ff02::2 ip6-allrouters
        ```

10. Navigate to the project and add all the environment variables: `nano .env`
    (if it doesn't exist: echo "export CORE_DATABASE_NAME='db_name'" >> .env)

    Change all the values to your local values and make sure of writting the "localhost" as the IP
    _Virtualbox eg: 10.0.2.2_

    ```
    export CORE_DATABASE_NAME=''
    export CM_DATABASE_NAME=''
    export CM_DATABASE_ENGINE='django.db.backends.mysql'
    export CM_DATABASE_USER=''
    export CM_DATABASE_PASSWORD=''
    export CM_DATABASE_HOST='localhostIp'
    export CM_DATABASE_PORT=''
    export CORE_DATABASE_NAME=''
    export CORE_DATABASE_ENGINE='django.db.backends.mysql'
    export CORE_DATABASE_USER=''
    export CORE_DATABASE_PASSWORD=''
    export CORE_DATABASE_HOST='localhostIp'
    export CORE_DATABASE_PORT=''
    export CORE_MESSENGER_USERS_DATABASE_NAME=''
    export CORE_MESSENGER_USERS_DATABASE_ENGINE='django.db.backends.mysql'
    export CORE_MESSENGER_USERS_DATABASE_USER=''
    export CORE_MESSENGER_USERS_DATABASE_PASSWORD=''
    export CORE_MESSENGER_USERS_DATABASE_HOST='localhostIp'
    export CORE_MESSENGER_USERS_DATABASE_PORT=''
    export CORE_POSTS_DATABASE_NAME=''
    export CORE_POSTS_DATABASE_ENGINE='django.db.backends.mysql'
    export CORE_POSTS_DATABASE_USER=''
    export CORE_POSTS_DATABASE_PASSWORD=''
    export CORE_POSTS_DATABASE_HOST='localhostIp'
    export CORE_POSTS_DATABASE_PORT=''
    ```

11. run server: `python3 manage.py runserver`
